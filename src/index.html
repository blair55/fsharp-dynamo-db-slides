<!DOCTYPE html>
<html>

<head>
    <title>Wrapping the AWS DynamoDB client with F#</title>
    <meta charset="utf-8">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
        @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
        @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

        body {
            font-family: 'Droid Serif';
        }

        h1,
        h2,
        h3 {
            font-family: 'Yanone Kaffeesatz';
            font-weight: normal;
        }

        .remark-code,
        .remark-inline-code {
            font-family: 'Ubuntu Mono';
        }
    </style>
</head>

<body>
    <textarea id="source">

class: center, middle

# Wrapping the AWS DynamoDB client with F# #

---

# TotallyMoney Mission

* Improve the UK's credit score

* Free credit report service launched 2017

* ~3 million customers


---

# TotallyMoney Tech Team

* ~30 members & growing

![tech team](teamsmall.jpg)

???

includes infosec & ops


---

# TotallyMoney Tech

* React & Reach Native

* Node & Typescript

* F# & C#


---

# TotallyMoney on AWS

* Lambda

* ECS

* Elastic Beanstalk

* S3, SNS, SQS, Kinesis

* RDS

* DynamoDB

???

since 2011

---

# We're hiring!

* Backend and frontend

* Sunday Times Best Small Companies to Work For 2019


---

# Me

* C# background

* F# since 2012

* I don't know category theory!


---

# F# for fun and profit

* Scott Wlaschin

![scott](https://ndc-london.com/images/speaker/scott_Wlaschin-300.jpg)

    
???
    
I just know this code is highly readable
I want to share this journey of understanding what this means

---

# What's the plan?

![venn](venn.png)

???

dynamo db provides a nice interface for wrapping with Reader

then run some fsi stuff

just shout questions

domain modelling principles


---

name: ddb

# DynamoDB

* NoSQL

* Key-value document store

* OLTP

???

all data returned with single request

---

template: ddb

### Pros

* cloud hosted

* pay-as-you-go pricing

* scalability

* remains fast

* flexible, complex schema

???

+ no normalizing data, can be stored with single write to disk
+ no performance hit with joins
+ no performance hit with ACID transactions


---

template: ddb

### Cons

* upfront design

* access patterns must be known

* no adhoc queries, no OLAP

* highly optimized, inflexible

???

- single table design steep learning curve


---

# FSharp.AWS.DynamoDb 

* Fully featured

* [https://github.com/fsprojects/FSharp.AWS.DynamoDB](https://github.com/fsprojects/FSharp.AWS.DynamoDB)

???

code I will show is in production but not full library


---
name:ddb2

# DynamoDB continued...


---
template:ddb2

* No joins!

--

* Get item, Query & Scan

--

* Tables are schemaless

???

realised that join operations are costly and yet the data returned was also unused
main mode of accessing data is using an item key (get by id)

items can varying in attribute length, no limit to number of attributes but item size must be under 400Kb


---

template:ddb2

### Attribute types

* Scalar: string, number, null, bool & binary

* Set: string, number & binary

* Doc: list, map

--

* [Amazon DynamoDB documentation](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.NamingRulesDataTypes.html#HowItWorks.DataTypes)


???

guid & dates as String

---

template:ddb2

```fsharp
new Dictionary<string, AttributeValue>()
```

???

Get & Set


---

template:ddb2

```fsharp
new AttributeValue(S = "foo")
```

---

template:ddb2

```fsharp
new AttributeValue(N = "1.23")
```

---

# Demo

???

Write Item
Get Item


---

# Client library review

--

* Cumbersome & verbose

--

* Conversion to C# list needed

--

* Zero & multiple values could be set on the AttVal constructor

--

* Error prone string numbers (N, NS)

--

* Set duplicates

--

* Empty Set

???

Enforce Set semantics with F# set type
Does not make illegal states unrepresentable



---

# The Attribute Type Model

--

* Illegal states unrepresentable (exactly one constructor used)

--

* Empty set problem gone

--

* Set duplicate problem gone

--

* Cannot pass a string to `N`

--

* Can work with F# `list`

???

Demo rich put item

---

# Questions?

???

* complexity in reading rich object

---

# Domain Types

--

```fsharp
type Customer =
  { Id : Guid
    Email : String
    IsVerified : Boolean
    DateOfBirth : DateTime
    Balance : Decimal }
```

--

> Our challenge is to turn a Dictionary into a record!

---

# Domain Types

```fsharp
let buildCustomer id email verified dob balance =
  { Id = id 
    Email = email
    IsVerified = verified 
    DateOfBirth = dob 
    Balance = balance }
```

--

```fsharp
let readCustomer =
  buildCustomer
  <!> readGuid   "id"
  <*> readString "email"
  <*> readBool   "verified"
  <*> readDate   "dob"
  <*> readNumber "balance" decimal
```

???

demo


---

# Reader Applicative

* using `map` & `apply` function

* parallel implementation

* not monadic `return` & `bind`


---

# Nested types

```fsharp
type Address =
  { FirstLine : String
    SecondLine : String
    PostCode : String
    CountryCode : int }
```

```fsharp
type Customer =
  { Id : Guid
    Email : String
    Address : Address
    IsVerified : Boolean
    DateOfBirth : DateTime
    Balance : Decimal }
```

???

document db gonna have nested types


---

# Result Reader

* idomatic error handling

* option type

???

demo


---

# Queries & beyond

---

# Fin

---



    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
        var slideshow = remark.create();
    </script>
    <style>
        .remark-code {
            font-size: 24px;
            line-height: 30px;
        }
    </style>
</body>

</html>